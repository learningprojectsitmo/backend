erDiagram
    %% Добавляем новые таблицы для настроек
    setting_definitions {
        bigint id PK
        varchar key UK
        varchar name
        varchar description
        varchar data_type "boolean|number|string|json|array"
        json default_value
        json validation_rules
        varchar category
        boolean is_required
        boolean is_system
        timestamp created_at
    }

    global_settings {
        bigint id PK
        bigint setting_id FK
        json value
        bigint updated_by FK
        timestamp updated_at
        timestamp effective_from
        timestamp effective_to
    }

    space_settings {
        bigint id PK
        bigint space_id FK
        bigint setting_id FK
        json value
        boolean is_inherited
        bigint updated_by FK
        timestamp updated_at
    }

    project_settings {
        bigint id PK
        bigint project_id FK
        bigint setting_id FK
        json value
        boolean is_inherited
        bigint updated_by FK
        timestamp updated_at
    }

    user_settings {
        bigint id PK
        bigint user_id FK
        bigint setting_id FK
        json value
        boolean is_inherited
        bigint updated_by FK
        timestamp updated_at
    }

    feature_flags {
        bigint id PK
        varchar name UK
        varchar description
        boolean is_enabled_globally
        json rollout_percentage
        json target_users
        json target_spaces
        timestamp created_at
        timestamp updated_at
    }

    %% Существующие таблицы (упрощенно)
    users ||--o{ user_settings : "has_settings"
    spaces ||--o{ space_settings : "has_settings"
    projects ||--o{ project_settings : "has_settings"

    setting_definitions ||--o{ global_settings : "defined_in"
    setting_definitions ||--o{ space_settings : "defined_in"
    setting_definitions ||--o{ project_settings : "defined_in"
    setting_definitions ||--o{ user_settings : "defined_in"
