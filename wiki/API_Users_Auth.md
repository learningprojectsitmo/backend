# API –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∏ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–û–±–∑–æ—Ä](#–æ–±–∑–æ—Ä)
2. [–†–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π](#—Ä–æ–ª–∏-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)
3. [–ü—Ä–æ—Ü–µ—Å—Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏](#–ø—Ä–æ—Ü–µ—Å—Å-–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏)
4. [API –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã](#api-—ç–Ω–¥–ø–æ–∏–Ω—Ç—ã)
   - [–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è](#—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è)
   - [–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è](#–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è)
   - [–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏](#—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)
5. [–°—Ö–µ–º—ã –¥–∞–Ω–Ω—ã—Ö](#—Å—Ö–µ–º—ã-–¥–∞–Ω–Ω—ã—Ö)
6. [–†–∞–±–æ—Ç–∞ —Å —Ç–æ–∫–µ–Ω–∞–º–∏](#—Ä–∞–±–æ—Ç–∞-—Å-—Ç–æ–∫–µ–Ω–∞–º–∏)
7. [–ö–æ–¥—ã –æ—à–∏–±–æ–∫](#–∫–æ–¥—ã-–æ—à–∏–±–æ–∫)
8. [–ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è](#–ø—Ä–∏–º–µ—Ä—ã-–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è)

---

## üéØ –û–±–∑–æ—Ä

–°–∏—Å—Ç–µ–º–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **JWT (JSON Web Tokens)** –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏.

### –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:
- ‚úÖ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚úÖ –í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É (–ø–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞)
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ (refresh)
- ‚úÖ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ (–ø—Ä–æ—Å–º–æ—Ç—Ä, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ)
- ‚úÖ –†–æ–ª–µ–≤–∞—è –º–æ–¥–µ–ª—å (—Å—Ç—É–¥–µ–Ω—Ç/–ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å)

---

## üë• –†–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### Student (–°—Ç—É–¥–µ–Ω—Ç)
**–ü–æ–ª–µ –≤ –ë–î:** `role: "student"`

**–ü—Ä–∞–≤–∞:**
- ‚úÖ –ü—Ä–æ—Å–º–æ—Ç—Ä —Å–ª–æ—Ç–æ–≤ –∑–∞—â–∏—Ç—ã
- ‚úÖ –ó–∞–ø–∏—Å—å –Ω–∞ –∑–∞—â–∏—Ç—É
- ‚úÖ –ü—Ä–æ—Å–º–æ—Ç—Ä —Å–≤–æ–µ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è
- ‚ùå –°–æ–∑–¥–∞–Ω–∏–µ –¥–Ω–µ–π/—Å–ª–æ—Ç–æ–≤ –∑–∞—â–∏—Ç—ã
- ‚ùå –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∏–ø–æ–≤ –ø—Ä–æ–µ–∫—Ç–æ–≤

---

### Teacher (–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å)
**–ü–æ–ª–µ –≤ –ë–î:** `role: "teacher"`

**–ü—Ä–∞–≤–∞:**
- ‚úÖ –í—Å–µ –ø—Ä–∞–≤–∞ —Å—Ç—É–¥–µ–Ω—Ç–∞
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∏–ø–æ–≤ –ø—Ä–æ–µ–∫—Ç–æ–≤
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –¥–Ω–µ–π –∑–∞—â–∏—Ç—ã
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ —Å–ª–æ—Ç–æ–≤ –∑–∞—â–∏—Ç—ã
- ‚úÖ –ü—Ä–æ—Å–º–æ—Ç—Ä —Å–ø–∏—Å–∫–∞ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

---

## üîê –ü—Ä–æ—Ü–µ—Å—Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

### –°—Ö–µ–º–∞ —Ä–∞–±–æ—Ç—ã —Å —Ç–æ–∫–µ–Ω–∞–º–∏

```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç email + password
           ‚Üì
2. –°–µ—Ä–≤–µ—Ä –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–∞–Ω–Ω—ã–µ
           ‚Üì
3. –°–µ—Ä–≤–µ—Ä –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç access_token + refresh_token
           ‚Üì
4. –ö–ª–∏–µ–Ω—Ç —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ç–æ–∫–µ–Ω—ã (localStorage/cookies)
           ‚Üì
5. –ö–ª–∏–µ–Ω—Ç –¥–æ–±–∞–≤–ª—è–µ—Ç access_token –≤ –∑–∞–≥–æ–ª–æ–≤–æ–∫ Authorization
           ‚Üì
6. –ö–æ–≥–¥–∞ access_token –∏—Å—Ç–µ–∫–∞–µ—Ç ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ–º refresh_token
```

### –í—Ä–µ–º—è –∂–∏–∑–Ω–∏ —Ç–æ–∫–µ–Ω–æ–≤

- **Access Token:** 30 –º–∏–Ω—É—Ç (–¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ API)
- **Refresh Token:** 7 –¥–Ω–µ–π (–¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è access token)

---

## üöÄ API –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã

**Base URL:** `http://localhost:8000/v1`

### –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è

#### 1. –°–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è)

```http
POST /v1/users/
```

**–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è:** –ù–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è (–æ—Ç–∫—Ä—ã—Ç—ã–π —ç–Ω–¥–ø–æ–∏–Ω—Ç)

**–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:**
```json
{
  "email": "student@example.com",
  "password_string": "securePassword123",
  "first_name": "–ò–≤–∞–Ω",
  "middle_name": "–ü–µ—Ç—Ä–æ–≤–∏—á",
  "last_name": "–ò–≤–∞–Ω–æ–≤",
  "isu_number": 312345,
  "role": "student"
}
```

**–ü–æ–ª—è:**
- `email` (string, required) ‚Äî Email –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—É–Ω–∏–∫–∞–ª—å–Ω—ã–π)
- `password_string` (string, required) ‚Äî –ü–∞—Ä–æ–ª—å (–º–∏–Ω–∏–º—É–º 8 —Å–∏–º–≤–æ–ª–æ–≤)
- `first_name` (string, required) ‚Äî –ò–º—è
- `middle_name` (string, required) ‚Äî –û—Ç—á–µ—Å—Ç–≤–æ
- `last_name` (string, optional) ‚Äî –§–∞–º–∏–ª–∏—è
- `isu_number` (integer, optional) ‚Äî –ù–æ–º–µ—Ä –ò–°–£
- `role` (string, optional, default="student") ‚Äî –†–æ–ª—å: `"student"` –∏–ª–∏ `"teacher"`

**–û—Ç–≤–µ—Ç (201 Created):**
```json
{
  "id": 1,
  "email": "student@example.com",
  "first_name": "–ò–≤–∞–Ω",
  "middle_name": "–ü–µ—Ç—Ä–æ–≤–∏—á",
  "last_name": "–ò–≤–∞–Ω–æ–≤",
  "isu_number": 312345,
  "tg_nickname": null,
  "role": "student"
}
```

**–û—à–∏–±–∫–∏:**
- `400` ‚Äî Email —É–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
- `422` ‚Äî –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö (–Ω–µ–≤–∞–ª–∏–¥–Ω—ã–π email, –∫–æ—Ä–æ—Ç–∫–∏–π –ø–∞—Ä–æ–ª—å –∏ —Ç.–¥.)

**–ü—Ä–∏–º–µ—Ä (JavaScript):**
```javascript
const response = await fetch('http://localhost:8000/v1/users/', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({
    email: 'student@example.com',
    password_string: 'securePassword123',
    first_name: '–ò–≤–∞–Ω',
    middle_name: '–ü–µ—Ç—Ä–æ–≤–∏—á',
    last_name: '–ò–≤–∞–Ω–æ–≤',
    isu_number: 312345,
    role: 'student'
  })
});

const user = await response.json();
console.log('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–Ω:', user.id);
```

---

### –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

#### 2. –í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É (Login)

```http
POST /v1/auth/login
```

**–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è:** –ù–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è

**–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:**
```json
{
  "email": "student@example.com",
  "password": "securePassword123"
}
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "refresh_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "token_type": "bearer"
}
```

**–û—à–∏–±–∫–∏:**
- `401` ‚Äî –ù–µ–≤–µ—Ä–Ω—ã–π email –∏–ª–∏ –ø–∞—Ä–æ–ª—å

**–ü—Ä–∏–º–µ—Ä (JavaScript):**
```javascript
async function login(email, password) {
  const response = await fetch('http://localhost:8000/v1/auth/login', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({ email, password })
  });
  
  if (!response.ok) {
    throw new Error('–ù–µ–≤–µ—Ä–Ω—ã–π email –∏–ª–∏ –ø–∞—Ä–æ–ª—å');
  }
  
  const data = await response.json();
  
  // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–æ–∫–µ–Ω—ã
  localStorage.setItem('access_token', data.access_token);
  localStorage.setItem('refresh_token', data.refresh_token);
  
  return data;
}

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
try {
  const tokens = await login('student@example.com', 'securePassword123');
  console.log('–í—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ');
} catch (error) {
  console.error('–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞:', error.message);
}
```

---

#### 3. –û–±–Ω–æ–≤–∏—Ç—å —Ç–æ–∫–µ–Ω (Refresh)

```http
POST /v1/auth/refresh
```

**–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è:** –ù–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è refresh_token)

**–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:**
```json
{
  "refresh_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
}
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "token_type": "bearer"
}
```

**–û—à–∏–±–∫–∏:**
- `401` ‚Äî Refresh token –Ω–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω –∏–ª–∏ –∏—Å—Ç–µ–∫

**–ü—Ä–∏–º–µ—Ä (JavaScript):**
```javascript
async function refreshAccessToken() {
  const refreshToken = localStorage.getItem('refresh_token');
  
  if (!refreshToken) {
    throw new Error('Refresh token –Ω–µ –Ω–∞–π–¥–µ–Ω');
  }
  
  const response = await fetch('http://localhost:8000/v1/auth/refresh', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({
      refresh_token: refreshToken
    })
  });
  
  if (!response.ok) {
    // Refresh token –∏—Å—Ç–µ–∫, –Ω—É–∂–Ω–æ –∑–∞–Ω–æ–≤–æ –≤–æ–π—Ç–∏
    localStorage.clear();
    window.location.href = '/login';
    return;
  }
  
  const data = await response.json();
  localStorage.setItem('access_token', data.access_token);
  
  return data.access_token;
}
```

---

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏

#### 4. –ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

```http
GET /v1/users/me
```

**–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è:** –¢—Ä–µ–±—É–µ—Ç—Å—è

**–û—Ç–≤–µ—Ç:**
```json
{
  "id": 1,
  "email": "student@example.com",
  "first_name": "–ò–≤–∞–Ω",
  "middle_name": "–ü–µ—Ç—Ä–æ–≤–∏—á",
  "last_name": "–ò–≤–∞–Ω–æ–≤",
  "isu_number": 312345,
  "tg_nickname": null,
  "role": "student"
}
```

**–ü—Ä–∏–º–µ—Ä (JavaScript):**
```javascript
async function getCurrentUser() {
  const token = localStorage.getItem('access_token');
  
  const response = await fetch('http://localhost:8000/v1/users/me', {
    headers: {
      'Authorization': `Bearer ${token}`
    }
  });
  
  if (response.status === 401) {
    // –¢–æ–∫–µ–Ω –∏—Å—Ç–µ–∫, –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –æ–±–Ω–æ–≤–∏—Ç—å
    await refreshAccessToken();
    return getCurrentUser(); // –ü–æ–≤—Ç–æ—Ä–∏—Ç—å –∑–∞–ø—Ä–æ—Å
  }
  
  return await response.json();
}
```

---

#### 5. –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

```http
GET /v1/users/?page=1&limit=10
```

**–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è:** –¢—Ä–µ–±—É–µ—Ç—Å—è

**Query –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `page` (integer, default=1) ‚Äî –ù–æ–º–µ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- `limit` (integer, default=10, max=100) ‚Äî –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —ç–ª–µ–º–µ–Ω—Ç–æ–≤

**–û—Ç–≤–µ—Ç:**
```json
{
  "items": [
    {
      "id": 1,
      "email": "student@example.com",
      "first_name": "–ò–≤–∞–Ω",
      "middle_name": "–ü–µ—Ç—Ä–æ–≤–∏—á",
      "last_name": "–ò–≤–∞–Ω–æ–≤",
      "isu_number": 312345,
      "tg_nickname": null,
      "role": "student"
    },
    {
      "id": 2,
      "email": "teacher@example.com",
      "first_name": "–ü–µ—Ç—Ä",
      "middle_name": "–°–µ—Ä–≥–µ–µ–≤–∏—á",
      "last_name": "–ü–µ—Ç—Ä–æ–≤",
      "isu_number": 100001,
      "tg_nickname": "@teacher",
      "role": "teacher"
    }
  ],
  "total": 25,
  "page": 1,
  "limit": 10,
  "total_pages": 3
}
```

---

#### 6. –ü–æ–ª—É—á–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ ID

```http
GET /v1/users/{user_id}
```

**–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è:** –¢—Ä–µ–±—É–µ—Ç—Å—è

**–û—Ç–≤–µ—Ç:**
```json
{
  "id": 1,
  "email": "student@example.com",
  "first_name": "–ò–≤–∞–Ω",
  "middle_name": "–ü–µ—Ç—Ä–æ–≤–∏—á",
  "last_name": "–ò–≤–∞–Ω–æ–≤",
  "isu_number": 312345,
  "tg_nickname": null,
  "role": "student"
}
```

**–û—à–∏–±–∫–∏:**
- `404` ‚Äî –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω

---

#### 7. –û–±–Ω–æ–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

```http
PATCH /v1/users/{user_id}
```

**–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è:** –¢—Ä–µ–±—É–µ—Ç—Å—è

**–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞ (–≤—Å–µ –ø–æ–ª—è –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã):**
```json
{
  "first_name": "–ò–≤–∞–Ω",
  "last_name": "–ò–≤–∞–Ω–æ–≤",
  "tg_nickname": "@ivan_ivanov",
  "role": "teacher"
}
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "id": 1,
  "email": "student@example.com",
  "first_name": "–ò–≤–∞–Ω",
  "middle_name": "–ü–µ—Ç—Ä–æ–≤–∏—á",
  "last_name": "–ò–≤–∞–Ω–æ–≤",
  "isu_number": 312345,
  "tg_nickname": "@ivan_ivanov",
  "role": "teacher"
}
```

**–û—à–∏–±–∫–∏:**
- `404` ‚Äî –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω

---

#### 8. –£–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

```http
DELETE /v1/users/{user_id}
```

**–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è:** –¢—Ä–µ–±—É–µ—Ç—Å—è

**–û—Ç–≤–µ—Ç (204 No Content):** –ü—É—Å—Ç–æ–π –æ—Ç–≤–µ—Ç

**–û—à–∏–±–∫–∏:**
- `404` ‚Äî –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω

---

## üìä –°—Ö–µ–º—ã –¥–∞–Ω–Ω—ã—Ö

### UserCreate (–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è)

```typescript
{
  email: string;              // Email (—É–Ω–∏–∫–∞–ª—å–Ω—ã–π)
  password_string: string;    // –ü–∞—Ä–æ–ª—å (–º–∏–Ω–∏–º—É–º 8 —Å–∏–º–≤–æ–ª–æ–≤)
  first_name: string;         // –ò–º—è
  middle_name: string;        // –û—Ç—á–µ—Å—Ç–≤–æ
  last_name?: string;         // –§–∞–º–∏–ª–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
  isu_number?: number;        // –ù–æ–º–µ—Ä –ò–°–£ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
  role?: "student" | "teacher"; // –†–æ–ª—å (default: "student")
}
```

### UserFull (–ü–æ–ª–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è)

```typescript
{
  id: number;
  email: string;
  first_name: string;
  middle_name: string;
  last_name: string | null;
  isu_number: number | null;
  tg_nickname: string | null;
  role: "student" | "teacher";
}
```

### UserUpdate (–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ)

```typescript
{
  email?: string;
  first_name?: string;
  middle_name?: string;
  last_name?: string;
  isu_number?: number;
  tg_nickname?: string;
  role?: "student" | "teacher";
}
```

### AuthRequest (–í—Ö–æ–¥)

```typescript
{
  email: string;
  password: string;
}
```

### TokenPair (–¢–æ–∫–µ–Ω—ã)

```typescript
{
  access_token: string;
  refresh_token?: string;  // –¢–æ–ª—å–∫–æ –ø—Ä–∏ –ª–æ–≥–∏–Ω–µ
  token_type: "bearer";
}
```

---

## üîë –†–∞–±–æ—Ç–∞ —Å —Ç–æ–∫–µ–Ω–∞–º–∏

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ –≤ –∑–∞–ø—Ä–æ—Å—ã

**–í—Å–µ –∑–∞—â–∏—â–µ–Ω–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã —Ç—Ä–µ–±—É—é—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫:**

```http
Authorization: Bearer <access_token>
```

**–ü—Ä–∏–º–µ—Ä:**
```javascript
const token = localStorage.getItem('access_token');

fetch('/v1/users/me', {
  headers: {
    'Authorization': `Bearer ${token}`
  }
});
```

---

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞

–°–æ–∑–¥–∞–π—Ç–µ wrapper –¥–ª—è fetch —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º —Ç–æ–∫–µ–Ω–∞:

```javascript
async function apiRequest(url, options = {}) {
  const token = localStorage.getItem('access_token');
  
  // –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–∫–µ–Ω –∫ –∑–∞–ø—Ä–æ—Å—É
  const headers = {
    ...options.headers,
    'Authorization': `Bearer ${token}`
  };
  
  let response = await fetch(url, { ...options, headers });
  
  // –ï—Å–ª–∏ 401 - —Ç–æ–∫–µ–Ω –∏—Å—Ç–µ–∫
  if (response.status === 401) {
    console.log('Token expired, refreshing...');
    
    // –ü–æ–ø—ã—Ç–∞—Ç—å—Å—è –æ–±–Ω–æ–≤–∏—Ç—å —Ç–æ–∫–µ–Ω
    const newToken = await refreshAccessToken();
    
    if (newToken) {
      // –ü–æ–≤—Ç–æ—Ä–∏—Ç—å –∑–∞–ø—Ä–æ—Å —Å –Ω–æ–≤—ã–º —Ç–æ–∫–µ–Ω–æ–º
      headers.Authorization = `Bearer ${newToken}`;
      response = await fetch(url, { ...options, headers });
    } else {
      // Refresh token —Ç–æ–∂–µ –∏—Å—Ç–µ–∫ - –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ –ª–æ–≥–∏–Ω
      window.location.href = '/login';
      return;
    }
  }
  
  return response;
}

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
const response = await apiRequest('/v1/users/me');
const user = await response.json();
```

---

### Interceptor –¥–ª—è Axios (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ)

```javascript
import axios from 'axios';

const api = axios.create({
  baseURL: 'http://localhost:8000'
});

// Request interceptor
api.interceptors.request.use(
  (config) => {
    const token = localStorage.getItem('access_token');
    if (token) {
      config.headers.Authorization = `Bearer ${token}`;
    }
    return config;
  },
  (error) => Promise.reject(error)
);

// Response interceptor
api.interceptors.response.use(
  (response) => response,
  async (error) => {
    const originalRequest = error.config;
    
    // –ï—Å–ª–∏ 401 –∏ —ç—Ç–æ –Ω–µ –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞–ø—Ä–æ—Å
    if (error.response?.status === 401 && !originalRequest._retry) {
      originalRequest._retry = true;
      
      try {
        const newToken = await refreshAccessToken();
        originalRequest.headers.Authorization = `Bearer ${newToken}`;
        return api(originalRequest);
      } catch (refreshError) {
        // Refresh failed, redirect to login
        localStorage.clear();
        window.location.href = '/login';
        return Promise.reject(refreshError);
      }
    }
    
    return Promise.reject(error);
  }
);

export default api;

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
import api from './api';

const user = await api.get('/v1/users/me');
```

---

## ‚ö†Ô∏è –ö–æ–¥—ã –æ—à–∏–±–æ–∫

### 400 Bad Request
**–ü—Ä–∏—á–∏–Ω—ã:**
- Email —É–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
- –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö

**–ü—Ä–∏–º–µ—Ä:**
```json
{
  "detail": "User with this email already exists"
}
```

---

### 401 Unauthorized
**–ü—Ä–∏—á–∏–Ω—ã:**
- –ù–µ–≤–µ—Ä–Ω—ã–π email –∏–ª–∏ –ø–∞—Ä–æ–ª—å (–ø—Ä–∏ –ª–æ–≥–∏–Ω–µ)
- –¢–æ–∫–µ–Ω –Ω–µ –ø–µ—Ä–µ–¥–∞–Ω –∏–ª–∏ –Ω–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω
- –¢–æ–∫–µ–Ω –∏—Å—Ç–µ–∫

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–∏ –ª–æ–≥–∏–Ω–µ: –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å email/–ø–∞—Ä–æ–ª—è
2. –ü—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ: –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Ç–æ–∫–µ–Ω –ø–µ—Ä–µ–¥–∞–Ω –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ
3. –ï—Å–ª–∏ —Ç–æ–∫–µ–Ω –∏—Å—Ç–µ–∫: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å refresh token

---

### 403 Forbidden
**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–∞–≤

**–ü—Ä–∏–º–µ—Ä:** –°—Ç—É–¥–µ–Ω—Ç –ø—ã—Ç–∞–µ—Ç—Å—è —Å–æ–∑–¥–∞—Ç—å –¥–µ–Ω—å –∑–∞—â–∏—Ç—ã

**–°–æ–æ–±—â–µ–Ω–∏–µ:**
```json
{
  "detail": "Only teachers can perform this action"
}
```

---

### 404 Not Found
**–ü—Ä–∏—á–∏–Ω–∞:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω

---

### 422 Unprocessable Entity
**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö

**–ü—Ä–∏–º–µ—Ä:**
```json
{
  "detail": [
    {
      "loc": ["body", "email"],
      "msg": "value is not a valid email address",
      "type": "value_error.email"
    },
    {
      "loc": ["body", "password_string"],
      "msg": "field required",
      "type": "value_error.missing"
    }
  ]
}
```

---

## üíª –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

```javascript
// 1. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
async function register(userData) {
  const response = await fetch('http://localhost:8000/v1/users/', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(userData)
  });
  
  if (!response.ok) {
    const error = await response.json();
    throw new Error(error.detail);
  }
  
  return await response.json();
}

// 2. –í—Ö–æ–¥
async function login(email, password) {
  const response = await fetch('http://localhost:8000/v1/auth/login', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ email, password })
  });
  
  if (!response.ok) {
    throw new Error('–ù–µ–≤–µ—Ä–Ω—ã–π email –∏–ª–∏ –ø–∞—Ä–æ–ª—å');
  }
  
  const tokens = await response.json();
  
  localStorage.setItem('access_token', tokens.access_token);
  localStorage.setItem('refresh_token', tokens.refresh_token);
  
  return tokens;
}

// 3. –ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
async function getCurrentUser() {
  const token = localStorage.getItem('access_token');
  
  const response = await fetch('http://localhost:8000/v1/users/me', {
    headers: { 'Authorization': `Bearer ${token}` }
  });
  
  if (!response.ok) {
    throw new Error('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è');
  }
  
  return await response.json();
}

// 4. –û–±–Ω–æ–≤–∏—Ç—å —Ç–æ–∫–µ–Ω
async function refreshToken() {
  const refreshToken = localStorage.getItem('refresh_token');
  
  const response = await fetch('http://localhost:8000/v1/auth/refresh', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ refresh_token: refreshToken })
  });
  
  if (!response.ok) {
    // Refresh token –∏—Å—Ç–µ–∫ - –ø–µ—Ä–µ–ª–æ–≥–∏–Ω
    logout();
    window.location.href = '/login';
    return null;
  }
  
  const data = await response.json();
  localStorage.setItem('access_token', data.access_token);
  
  return data.access_token;
}

// 5. –í—ã—Ö–æ–¥
function logout() {
  localStorage.removeItem('access_token');
  localStorage.removeItem('refresh_token');
  window.location.href = '/login';
}

// –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–ï
try {
  // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Å—Ç—É–¥–µ–Ω—Ç–∞
  await register({
    email: 'student@example.com',
    password_string: 'securePass123',
    first_name: '–ò–≤–∞–Ω',
    middle_name: '–ü–µ—Ç—Ä–æ–≤–∏—á',
    role: 'student'
  });
  
  // –í—Ö–æ–¥
  await login('student@example.com', 'securePass123');
  
  // –ü–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  const user = await getCurrentUser();
  console.log('–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å,', user.first_name);
  console.log('–í–∞—à–∞ —Ä–æ–ª—å:', user.role);
  
} catch (error) {
  console.error('–û—à–∏–±–∫–∞:', error.message);
}
```

---

### React Hook –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

```javascript
import { useState, useEffect } from 'react';

function useAuth() {
  const [user, setUser] = useState(null);
  const [loading, setLoading] = useState(true);
  
  useEffect(() => {
    checkAuth();
  }, []);
  
  async function checkAuth() {
    const token = localStorage.getItem('access_token');
    
    if (!token) {
      setLoading(false);
      return;
    }
    
    try {
      const response = await fetch('http://localhost:8000/v1/users/me', {
        headers: { 'Authorization': `Bearer ${token}` }
      });
      
      if (response.ok) {
        const userData = await response.json();
        setUser(userData);
      } else if (response.status === 401) {
        // –ü–æ–ø—ã—Ç–∞—Ç—å—Å—è –æ–±–Ω–æ–≤–∏—Ç—å —Ç–æ–∫–µ–Ω
        const newToken = await refreshToken();
        if (newToken) {
          await checkAuth(); // –ü–æ–≤—Ç–æ—Ä–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É
        }
      }
    } catch (error) {
      console.error('Auth check failed:', error);
    } finally {
      setLoading(false);
    }
  }
  
  async function login(email, password) {
    const response = await fetch('http://localhost:8000/v1/auth/login', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ email, password })
    });
    
    if (!response.ok) {
      throw new Error('–ù–µ–≤–µ—Ä–Ω—ã–π email –∏–ª–∏ –ø–∞—Ä–æ–ª—å');
    }
    
    const tokens = await response.json();
    localStorage.setItem('access_token', tokens.access_token);
    localStorage.setItem('refresh_token', tokens.refresh_token);
    
    await checkAuth();
  }
  
  function logout() {
    localStorage.removeItem('access_token');
    localStorage.removeItem('refresh_token');
    setUser(null);
  }
  
  return {
    user,
    loading,
    login,
    logout,
    isAuthenticated: !!user,
    isTeacher: user?.role === 'teacher',
    isStudent: user?.role === 'student'
  };
}

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–µ
function App() {
  const { user, loading, isTeacher, login, logout } = useAuth();
  
  if (loading) {
    return <div>–ó–∞–≥—Ä—É–∑–∫–∞...</div>;
  }
  
  if (!user) {
    return <LoginForm onLogin={login} />;
  }
  
  return (
    <div>
      <h1>–ü—Ä–∏–≤–µ—Ç, {user.first_name}!</h1>
      <p>–†–æ–ª—å: {user.role}</p>
      
      {isTeacher && (
        <button>–°–æ–∑–¥–∞—Ç—å –¥–µ–Ω—å –∑–∞—â–∏—Ç—ã</button>
      )}
      
      <button onClick={logout}>–í—ã–π—Ç–∏</button>
    </div>
  );
}
```

---

### Protected Route (React Router)

```javascript
import { Navigate } from 'react-router-dom';
import { useAuth } from './useAuth';

function ProtectedRoute({ children, requireTeacher = false }) {
  const { user, loading } = useAuth();
  
  if (loading) {
    return <div>–ó–∞–≥—Ä—É–∑–∫–∞...</div>;
  }
  
  if (!user) {
    return <Navigate to="/login" />;
  }
  
  if (requireTeacher && user.role !== 'teacher') {
    return <Navigate to="/forbidden" />;
  }
  
  return children;
}

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
<Routes>
  <Route path="/login" element={<LoginPage />} />
  
  <Route 
    path="/profile" 
    element={
      <ProtectedRoute>
        <ProfilePage />
      </ProtectedRoute>
    } 
  />
  
  <Route 
    path="/admin/create-defense-day" 
    element={
      <ProtectedRoute requireTeacher>
        <CreateDefenseDayPage />
      </ProtectedRoute>
    } 
  />
</Routes>
```

---

## üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### 1. –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤

**–í–∞—Ä–∏–∞–Ω—Ç—ã:**

1. **localStorage** (–ø—Ä–æ—Å—Ç–æ–π, –Ω–æ –º–µ–Ω–µ–µ –±–µ–∑–æ–ø–∞—Å–Ω—ã–π)
```javascript
localStorage.setItem('access_token', token);
```

2. **httpOnly cookies** (–±–æ–ª–µ–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ, –Ω–æ —Ç—Ä–µ–±—É–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –Ω–∞ –±—ç–∫–µ–Ω–¥–µ)
```javascript
// Backend –¥–æ–ª–∂–µ–Ω —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å cookie –ø—Ä–∏ –ª–æ–≥–∏–Ω–µ
// Frontend –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç cookie —Å –∫–∞–∂–¥—ã–º –∑–∞–ø—Ä–æ—Å–æ–º
```

3. **sessionStorage** (—Ç–æ–∫–µ–Ω —É–¥–∞–ª—è–µ—Ç—Å—è –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ –≤–∫–ª–∞–¥–∫–∏)
```javascript
sessionStorage.setItem('access_token', token);
```

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –î–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å httpOnly cookies.

---

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–æ–ª–∏ –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ

```javascript
function canCreateDefenseDay(user) {
  return user && user.role === 'teacher';
}

// –í –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–µ
{canCreateDefenseDay(user) && (
  <button onClick={createDefenseDay}>
    –°–æ–∑–¥–∞—Ç—å –¥–µ–Ω—å –∑–∞—â–∏—Ç—ã
  </button>
)}
```

**–í–∞–∂–Ω–æ:** –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ —Ç–æ–ª—å–∫–æ –¥–ª—è UX. –ë—ç–∫–µ–Ω–¥ –≤—Å–µ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø—Ä–∞–≤–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ!

---

### 3. –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏—Å—Ç–µ–∫—à–∏—Ö —Ç–æ–∫–µ–Ω–æ–≤

```javascript
// –°–æ–∑–¥–∞—Ç—å –≥–ª–æ–±–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫
window.addEventListener('tokenExpired', () => {
  // –ü–æ–∫–∞–∑–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
  alert('–°–µ—Å—Å–∏—è –∏—Å—Ç–µ–∫–ª–∞. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–æ–π–¥–∏—Ç–µ —Å–Ω–æ–≤–∞.');
  
  // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ –ª–æ–≥–∏–Ω
  window.location.href = '/login';
});

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ API wrapper
if (response.status === 401) {
  window.dispatchEvent(new Event('tokenExpired'));
}
```

---

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

- [API_Defense_System.md](./API_Defense_System.md) ‚Äî –°–∏—Å—Ç–µ–º–∞ –∑–∞–ø–∏—Å–∏ –Ω–∞ –∑–∞—â–∏—Ç—É
- [README.md](../README.md) ‚Äî –û—Å–Ω–æ–≤–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞

---

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2026-02-14  
**–í–µ—Ä—Å–∏—è API:** v1  
**–ê–≤—Ç–æ—Ä:** Backend Team
